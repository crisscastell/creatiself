{% extends 'base.html' %}
{% load static %}

{% block title %}Gestión de Antecedentes y Condiciones{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-teal-50 to-blue-50 pt-16 pb-12">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Encabezado principal con ilustración -->
        <div class="text-center mb-12">
            <div class="mx-auto h-24 w-24 bg-teal-100 rounded-full flex items-center justify-center mb-4">
                <i data-lucide="clipboard-list" class="w-12 h-12 text-teal-600"></i>
            </div>
            <h1 class="text-4xl font-extrabold text-gray-900 mb-3">
                Gestión de <span class="text-gray-800">Antecedentes</span> y <span class="text-gray-800">Condiciones</span>
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto">
                Administre el historial médico y condiciones de salud de los pacientes de manera eficiente
            </p>
        </div>

        <!-- Pestañas para navegación -->
        <div class="flex border-b border-gray-200 mb-8">
            <button id="tab-condiciones" class="tab-button active py-4 px-6 font-medium text-sm border-b-2 border-teal-500 text-teal-600">
                <i data-lucide="alert-circle" class="w-5 h-5 mr-2"></i> Condiciones
            </button>
            <button id="tab-antecedentes" class="tab-button py-4 px-6 font-medium text-sm text-gray-500 hover:text-gray-700">
                <i data-lucide="history" class="w-5 h-5 mr-2"></i> Antecedentes
            </button>
        </div>

        <!-- Sección de Condiciones (visible por defecto) -->
        <div id="seccion-condiciones" class="seccion-activa">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-10">
                <div class="p-6 bg-gradient-to-r from-teal-700 to-teal-600">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <i data-lucide="alert-circle" class="mr-3"></i> Administración de Condiciones Médicas
                    </h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 p-6">
                    <!-- Formulario para nueva condición -->
                    <div class="lg:col-span-1">
                        <div class="bg-teal-50 p-6 rounded-xl border border-teal-100 shadow-sm">
                            <h3 class="text-xl font-semibold text-teal-800 mb-4 flex items-center">
                                <i data-lucide="plus-circle" class="mr-2 text-teal-600"></i> Registrar Nueva Condición
                            </h3>
                            <form method="POST" action="{% url 'Crear_condicion' %}" class="space-y-5">
                                {% csrf_token %}
                                
                                <div>
                                    <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">Nombre de la condición</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                            <i data-lucide="tag" class="text-gray-400"></i>
                                        </div>
                                        <input type="text" id="nombre" name="nombre" 
                                               class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all"
                                               placeholder="Ej: Diabetes tipo 2">
                                    </div>
                                </div>

                                <div>
                                    <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-2">Descripción detallada</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 pt-3 flex items-start pointer-events-none">
                                            <i data-lucide="align-left" class="text-gray-400"></i>
                                        </div>
                                        <textarea id="descripcion" name="descripcion" rows="5" 
                                                  class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all"
                                                  placeholder="Describa los síntomas, características y detalles relevantes..."></textarea>
                                    </div>
                                </div>

                                <div class="flex items-center">
                                    <input type="checkbox" id="activo" name="activo" value="true" checked
                                        class="h-5 w-5 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
                                    <label for="activo" class="ml-3 block text-sm text-gray-700">Activar esta condición</label>
                                </div>

                                <button type="submit" 
                                        class="w-full bg-gradient-to-r from-teal-600 to-teal-500 hover:from-teal-700 hover:to-teal-600 text-white py-3 px-6 rounded-xl font-medium flex items-center justify-center gap-2 transition-all shadow-md hover:shadow-lg">
                                    <i data-lucide="save" class="w-5 h-5"></i> Guardar Condición
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de condiciones -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
                            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
                                <h3 class="text-lg font-medium text-gray-900">
                                    <i data-lucide="list" class="inline mr-2 text-teal-600"></i> Condiciones Registradas
                                </h3>
                                <span class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full border border-gray-200">
                                    {{ page_obj_condiciones.paginator.count }} registros
                                </span>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Condición</th>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for condicion in page_obj_condiciones %}
                                            <tr class="hover:bg-gray-50 transition-colors duration-150">
                                                <td class="px-6 py-4 whitespace-nowrap">
                                                    <div class="flex items-center">
                                                        <div class="flex-shrink-0 h-10 w-10 bg-teal-100 rounded-full flex items-center justify-center">
                                                            <i data-lucide="alert-triangle" class="text-teal-600"></i>
                                                        </div>
                                                        <div class="ml-4">
                                                            <div class="text-sm font-medium text-gray-900">{{ condicion.nombre }}</div>
                                                            <div class="text-xs text-gray-500">
                                                                {% if condicion.activo %}
                                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span>
                                                                {% else %}
                                                                    <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Inactivo</span>
                                                                {% endif %}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4">
                                                    <div class="text-sm text-gray-600 max-w-xs truncate hover:whitespace-normal hover:overflow-visible">
                                                        {{ condicion.descripcion }}
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                                    <div class="flex justify-center space-x-2">
                                                        <button onclick="openModalEditarCondicion('{{ condicion.id }}')"
                                                                class="text-teal-600 hover:text-teal-900 p-2 rounded-lg hover:bg-teal-50 transition-colors"
                                                                title="Editar">
                                                            <i data-lucide="pencil" class="w-5 h-5"></i>
                                                        </button>
                                                        <form action="{% url 'Ocultar_condicion' condicion.id %}" method="POST" class="inline ocultar-form">
                                                            {% csrf_token %}
                                                            <button type="submit"
                                                                    class="text-rose-600 hover:text-rose-900 p-2 rounded-lg hover:bg-rose-50 transition-colors"
                                                                    title="Ocultar">
                                                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                </td>
                                            </tr>

                                            <!-- Modal de edición de condición -->
                                            <div id="modalEditarCondicion{{ condicion.id }}" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300">
                                                <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-6 relative transform transition-all duration-300 scale-95 opacity-0" id="modalContent{{ condicion.id }}">
                                                    <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-teal-500 to-teal-400 rounded-t-2xl"></div>
                                                    <div class="flex items-center mb-4">
                                                        <div class="p-2 rounded-full bg-teal-100 mr-3">
                                                            <i data-lucide="alert-circle" class="w-6 h-6 text-teal-600"></i>
                                                        </div>
                                                        <h2 class="text-xl font-bold text-gray-800">Editar Condición</h2>
                                                    </div>

                                                    <form id="form-editar-condicion{{ condicion.id }}" method="POST" action="{% url 'Editar_condicion' condicion.id %}">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="condicion_id" value="{{ condicion.id }}">

                                                        <div class="mb-5">
                                                            <label for="nombre" class="block text-sm font-medium text-gray-700 mb-2">Nombre</label>
                                                            <div class="relative">
                                                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                                                    <i data-lucide="tag" class="text-gray-400"></i>
                                                                </div>
                                                                <input type="text" name="nombre" id="editar_nombre{{ condicion.id }}" value="{{ condicion.nombre }}"
                                                                    class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">
                                                            </div>
                                                        </div>

                                                        <div class="mb-5">
                                                            <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
                                                            <div class="relative">
                                                                <div class="absolute inset-y-0 left-0 pl-3 pt-3 flex items-start pointer-events-none">
                                                                    <i data-lucide="align-left" class="text-gray-400"></i>
                                                                </div>
                                                                <textarea name="descripcion" id="editar_descripcion{{ condicion.id }}" rows="4"
                                                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">{{ condicion.descripcion }}</textarea>
                                                            </div>
                                                        </div>

                                                        <div class="flex items-center mb-6">
                                                            <input type="checkbox" id="activo" name="activo" value="true" {% if condicion.activo %}checked{% endif %}
                                                                class="h-5 w-5 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
                                                            <label for="activo" class="ml-3 block text-sm text-gray-700">Activar esta condición</label>
                                                        </div>

                                                        <div class="flex justify-end gap-3">
                                                            <button type="button" onclick="cerrarModalEditarCondicion({{ condicion.id }})"
                                                                    class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                                                                Cancelar
                                                            </button>
                                                            <button type="submit"
                                                                    class="px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors flex items-center gap-2">
                                                                <i data-lucide="save" class="w-4 h-4"></i> Guardar
                                                            </button>
                                                        </div>
                                                    </form>

                                                    <!-- Botón de cerrar (X) -->
                                                    <button onclick="cerrarModalEditarCondicion({{ condicion.id }})"
                                                            class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                                                        <i data-lucide="x" class="w-6 h-6"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        {% empty %}
                                            <tr>
                                                <td colspan="3" class="px-6 py-8 text-center">
                                                    <div class="flex flex-col items-center justify-center text-gray-400">
                                                        <i data-lucide="alert-circle" class="w-12 h-12 mb-3"></i>
                                                        <p class="text-lg">No hay condiciones registradas</p>
                                                        <p class="text-sm mt-1">Comience agregando una nueva condición</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <!-- Paginación mejorada -->
                            <div class="bg-white px-6 py-4 flex items-center justify-between border-t border-gray-200">
                                <div class="flex-1 flex justify-between sm:hidden">
                                    {% if page_obj_condiciones.has_previous %}
                                        <a href="?page_condiciones={{ page_obj_condiciones.previous_page_number }}" 
                                        class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                            Anterior
                                        </a>
                                    {% endif %}
                                    {% if page_obj_condiciones.has_next %}
                                        <a href="?page_condiciones={{ page_obj_condiciones.next_page_number }}" 
                                        class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                            Siguiente
                                        </a>
                                    {% endif %}
                                </div>
                                <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                    <div>
                                        <p class="text-sm text-gray-700">
                                            Mostrando <span class="font-medium">{{ page_obj_condiciones.start_index }}</span> a 
                                            <span class="font-medium">{{ page_obj_condiciones.end_index }}</span> de 
                                            <span class="font-medium">{{ page_obj_condiciones.paginator.count }}</span> resultados
                                        </p>
                                    </div>
                                    <div>
                                        <nav class="relative z-0 inline-flex shadow-sm rounded-md" aria-label="Pagination">
                                            {% if page_obj_condiciones.has_previous %}
                                                <a href="?page_condiciones=1" 
                                                class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Primera</span>
                                                    <i data-lucide="chevrons-left" class="h-5 w-5"></i>
                                                </a>
                                                <a href="?page_condiciones={{ page_obj_condiciones.previous_page_number }}" 
                                                class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Anterior</span>
                                                    <i data-lucide="chevron-left" class="h-5 w-5"></i>
                                                </a>
                                            {% endif %}

                                            {% for num in page_obj_condiciones.paginator.page_range %}
                                                {% if page_obj_condiciones.number == num %}
                                                    <a href="?page_condiciones={{ num }}" 
                                                    class="relative inline-flex items-center px-4 py-2 border border-teal-500 bg-teal-50 text-sm font-medium text-teal-600">
                                                        {{ num }}
                                                    </a>
                                                {% elif num > page_obj_condiciones.number|add:'-3' and num < page_obj_condiciones.number|add:'3' %}
                                                    <a href="?page_condiciones={{ num }}" 
                                                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                        {{ num }}
                                                    </a>
                                                {% endif %}
                                            {% endfor %}

                                            {% if page_obj_condiciones.has_next %}
                                                <a href="?page_condiciones={{ page_obj_condiciones.next_page_number }}" 
                                                class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Siguiente</span>
                                                    <i data-lucide="chevron-right" class="h-5 w-5"></i>
                                                </a>
                                                <a href="?page_condiciones={{ page_obj_condiciones.paginator.num_pages }}" 
                                                class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Última</span>
                                                    <i data-lucide="chevrons-right" class="h-5 w-5"></i>
                                                </a>
                                            {% endif %}
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sección de Antecedentes (oculta por defecto) -->
        <div id="seccion-antecedentes" class="hidden">
            <div class="bg-white rounded-2xl shadow-lg overflow-hidden mb-10">
                <div class="p-6 bg-gradient-to-r from-teal-700 to-teal-600">
                    <h2 class="text-2xl font-bold text-white flex items-center">
                        <i data-lucide="history" class="mr-3"></i> Administración de Antecedentes Médicos
                    </h2>
                </div>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 p-6">
                    <!-- Formulario para nuevo antecedente -->
                    <div class="lg:col-span-1">
                        <div class="bg-teal-50 p-6 rounded-xl border border-teal-100 shadow-sm">
                            <h3 class="text-xl font-semibold text-teal-800 mb-4 flex items-center">
                                <i data-lucide="plus-circle" class="mr-2 text-teal-600"></i> Registrar Nuevo Antecedente
                            </h3>
                            <form method="POST" action="{% url 'Crear_antecedentes' %}" class="space-y-5">
                                {% csrf_token %}
                                
                                <div>
                                    <label for="descripcion2" class="block text-sm font-medium text-gray-700 mb-2">Descripción del antecedente</label>
                                    <div class="relative">
                                        <div class="absolute inset-y-0 left-0 pl-3 pt-3 flex items-start pointer-events-none">
                                            <i data-lucide="file-text" class="text-gray-400"></i>
                                        </div>
                                        <textarea id="descripcion2" name="descripcion" rows="6" 
                                                  class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-teal-500 focus:border-teal-500 transition-all"
                                                  placeholder="Describa el antecedente médico con todos los detalles relevantes..."></textarea>
                                    </div>
                                </div>

                                <div class="flex items-center">
                                    <input type="checkbox" id="activo" name="activo" value="true" checked
                                        class="h-5 w-5 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
                                    <label for="activo" class="ml-3 block text-sm text-gray-700">Activar este antecedente</label>
                                </div>

                                <button type="submit" 
                                        class="w-full bg-gradient-to-r from-teal-600 to-teal-500 hover:from-teal-700 hover:to-teal-600 text-white py-3 px-6 rounded-xl font-medium flex items-center justify-center gap-2 transition-all shadow-md hover:shadow-lg">
                                    <i data-lucide="save" class="w-5 h-5"></i> Guardar Antecedente
                                </button>
                            </form>
                        </div>
                    </div>

                    <!-- Lista de antecedentes -->
                    <div class="lg:col-span-2">
                        <div class="bg-white rounded-xl border border-gray-200 overflow-hidden shadow-sm">
                            <div class="px-6 py-4 bg-gray-50 border-b border-gray-200 flex justify-between items-center">
                                <h3 class="text-lg font-medium text-gray-900">
                                    <i data-lucide="list" class="inline mr-2 text-teal-600"></i> Antecedentes Registrados
                                </h3>
                                <span class="text-sm text-gray-500 bg-white px-3 py-1 rounded-full border border-gray-200">
                                    {{ page_obj_antecedentes.paginator.count }} registros
                                </span>
                            </div>
                            
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Estado</th>
                                            <th scope="col" class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        {% for antecedente in page_obj_antecedentes %}
                                            <tr class="hover:bg-gray-50 transition-colors duration-150">
                                                <td class="px-6 py-4">
                                                    <div class="flex items-start">
                                                        <div class="flex-shrink-0 h-10 w-10 bg-teal-100 rounded-full flex items-center justify-center mt-1">
                                                            <i data-lucide="file-text" class="text-teal-600"></i>
                                                        </div>
                                                        <div class="ml-4">
                                                            <div class="text-sm text-gray-700 max-w-prose">
                                                                {{ antecedente.descripcion }}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center">
                                                    {% if antecedente.activo %}
                                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">Activo</span>
                                                    {% else %}
                                                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">Inactivo</span>
                                                    {% endif %}
                                                </td>
                                                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                                    <div class="flex justify-center space-x-2">
                                                        <button onclick="openModalEditarAntecedente('{{ antecedente.id }}')"
                                                                class="text-teal-600 hover:text-teal-900 p-2 rounded-lg hover:bg-teal-50 transition-colors"
                                                                title="Editar">
                                                            <i data-lucide="pencil" class="w-5 h-5"></i>
                                                        </button>
                                                        <form action="{% url 'Ocultar_antecedente' antecedente.id %}" method="POST" class="inline ocultar-form">
                                                            {% csrf_token %}
                                                            <button type="submit"
                                                                    class="text-rose-600 hover:text-rose-900 p-2 rounded-lg hover:bg-rose-50 transition-colors"
                                                                    title="Ocultar">
                                                                <i data-lucide="trash-2" class="w-5 h-5"></i>
                                                            </button>
                                                        </form>
                                                    </div>
                                                </td>
                                            </tr>

                                            <!-- Modal de edición de antecedente -->
                                            <div id="modalEditarAntecedente{{ antecedente.id }}" class="fixed inset-0 z-50 hidden items-center justify-center bg-black bg-opacity-50 transition-opacity duration-300">
                                                <div class="bg-white rounded-2xl shadow-xl w-full max-w-lg p-6 relative transform transition-all duration-300 scale-95 opacity-0" id="modalAntecedenteContent{{ antecedente.id }}">
                                                    <div class="absolute top-0 left-0 right-0 h-2 bg-gradient-to-r from-teal-500 to-teal-400 rounded-t-2xl"></div>
                                                    <div class="flex items-center mb-4">
                                                        <div class="p-2 rounded-full bg-teal-100 mr-3">
                                                            <i data-lucide="file-text" class="w-6 h-6 text-teal-600"></i>
                                                        </div>
                                                        <h2 class="text-xl font-bold text-gray-800">Editar Antecedente</h2>
                                                    </div>

                                                    <form id="form-editar-antecedente{{ antecedente.id }}" method="POST" action="{% url 'Editar_antecedente' antecedente.id %}">
                                                        {% csrf_token %}
                                                        <input type="hidden" name="antecedente_id" value="{{ antecedente.id }}">

                                                        <div class="mb-5">
                                                            <label for="descripcion" class="block text-sm font-medium text-gray-700 mb-2">Descripción</label>
                                                            <div class="relative">
                                                                <div class="absolute inset-y-0 left-0 pl-3 pt-3 flex items-start pointer-events-none">
                                                                    <i data-lucide="file-text" class="text-gray-400"></i>
                                                                </div>
                                                                <textarea name="descripcion" id="editar_descripcion{{ antecedente.id }}" rows="5"
                                                                        class="pl-10 w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500">{{ antecedente.descripcion }}</textarea>
                                                            </div>
                                                        </div>

                                                        <div class="flex items-center mb-6">
                                                            <input type="checkbox" id="activo" name="activo" value="true" {% if antecedente.activo %}checked{% endif %}
                                                                class="h-5 w-5 text-teal-600 focus:ring-teal-500 border-gray-300 rounded">
                                                            <label for="activo" class="ml-3 block text-sm text-gray-700">Activar este antecedente</label>
                                                        </div>

                                                        <div class="flex justify-end gap-3">
                                                            <button type="button" onclick="cerrarModalEditarAntecedente({{ antecedente.id }})"
                                                                    class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors">
                                                                Cancelar
                                                            </button>
                                                            <button type="submit"
                                                                    class="px-4 py-2 bg-teal-600 hover:bg-teal-700 text-white rounded-lg transition-colors flex items-center gap-2">
                                                                <i data-lucide="save" class="w-4 h-4"></i> Guardar
                                                            </button>
                                                        </div>
                                                    </form>

                                                    <!-- Botón de cerrar (X) -->
                                                    <button onclick="cerrarModalEditarAntecedente({{ antecedente.id }})"
                                                            class="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors">
                                                        <i data-lucide="x" class="w-6 h-6"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        {% empty %}
                                            <tr>
                                                <td colspan="3" class="px-6 py-8 text-center">
                                                    <div class="flex flex-col items-center justify-center text-gray-400">
                                                        <i data-lucide="alert-circle" class="w-12 h-12 mb-3"></i>
                                                        <p class="text-lg">No hay antecedentes registrados</p>
                                                        <p class="text-sm mt-1">Comience agregando un nuevo antecedente</p>
                                                    </div>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                            <!-- Paginación mejorada -->
                            <div class="bg-white px-6 py-4 flex items-center justify-between border-t border-gray-200">
                                <div class="flex-1 flex justify-between sm:hidden">
                                    {% if page_obj_antecedentes.has_previous %}
                                        <a href="?page_antecedentes={{ page_obj_antecedentes.previous_page_number }}" 
                                        class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                            Anterior
                                        </a>
                                    {% endif %}
                                    {% if page_obj_antecedentes.has_next %}
                                        <a href="?page_antecedentes={{ page_obj_antecedentes.next_page_number }}" 
                                        class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                            Siguiente
                                        </a>
                                    {% endif %}
                                </div>
                                <div class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between">
                                    <div>
                                        <p class="text-sm text-gray-700">
                                            Mostrando <span class="font-medium">{{ page_obj_antecedentes.start_index }}</span> a 
                                            <span class="font-medium">{{ page_obj_antecedentes.end_index }}</span> de 
                                            <span class="font-medium">{{ page_obj_antecedentes.paginator.count }}</span> resultados
                                        </p>
                                    </div>
                                    <div>
                                        <nav class="relative z-0 inline-flex shadow-sm rounded-md" aria-label="Pagination">
                                            {% if page_obj_antecedentes.has_previous %}
                                                <a href="?page_antecedentes=1" 
                                                class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Primera</span>
                                                    <i data-lucide="chevrons-left" class="h-5 w-5"></i>
                                                </a>
                                                <a href="?page_antecedentes={{ page_obj_antecedentes.previous_page_number }}" 
                                                class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Anterior</span>
                                                    <i data-lucide="chevron-left" class="h-5 w-5"></i>
                                                </a>
                                            {% endif %}

                                            {% for num in page_obj_antecedentes.paginator.page_range %}
                                                {% if page_obj_antecedentes.number == num %}
                                                    <a href="?page_antecedentes={{ num }}" 
                                                    class="relative inline-flex items-center px-4 py-2 border border-teal-500 bg-teal-50 text-sm font-medium text-teal-600">
                                                        {{ num }}
                                                    </a>
                                                {% elif num > page_obj_antecedentes.number|add:'-3' and num < page_obj_antecedentes.number|add:'3' %}
                                                    <a href="?page_antecedentes={{ num }}" 
                                                    class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                        {{ num }}
                                                    </a>
                                                {% endif %}
                                            {% endfor %}

                                            {% if page_obj_antecedentes.has_next %}
                                                <a href="?page_antecedentes={{ page_obj_antecedentes.next_page_number }}" 
                                                class="relative inline-flex items-center px-2 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Siguiente</span>
                                                    <i data-lucide="chevron-right" class="h-5 w-5"></i>
                                                </a>
                                                <a href="?page_antecedentes={{ page_obj_antecedentes.paginator.num_pages }}" 
                                                class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50">
                                                    <span class="sr-only">Última</span>
                                                    <i data-lucide="chevrons-right" class="h-5 w-5"></i>
                                                </a>
                                            {% endif %}
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Función para capitalizar la primera letra de cada oración
    function capitalizeFirstLetterEachSentence(text) {
        return text
            .toLowerCase()
            .replace(/(?:^|\.\s+)([a-záéíóúñ])/g, match => match.toUpperCase());
    }

    // Función para sanitizar y capitalizar el texto
    function sanitizeAndCapitalize(input) {
        let sanitized = input.value.replace(/[^A-Za-zÁÉÍÓÚáéíóúñÑ\s.,]/g, '');
        sanitized = capitalizeFirstLetterEachSentence(sanitized);
        input.value = sanitized;
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Inicializar pestañas
        const tabCondiciones = document.getElementById('tab-condiciones');
        const tabAntecedentes = document.getElementById('tab-antecedentes');
        const seccionCondiciones = document.getElementById('seccion-condiciones');
        const seccionAntecedentes = document.getElementById('seccion-antecedentes');

        tabCondiciones.addEventListener('click', function() {
            this.classList.add('active', 'border-teal-500', 'text-teal-600');
            this.classList.remove('text-gray-500', 'hover:text-gray-700');
            tabAntecedentes.classList.remove('active', 'border-teal-500', 'text-teal-600');
            tabAntecedentes.classList.add('text-gray-500', 'hover:text-gray-700');
            
            seccionCondiciones.classList.remove('hidden');
            seccionCondiciones.classList.add('seccion-activa');
            seccionAntecedentes.classList.add('hidden');
            seccionAntecedentes.classList.remove('seccion-activa');
        });

        tabAntecedentes.addEventListener('click', function() {
            this.classList.add('active', 'border-teal-500', 'text-teal-600');
            this.classList.remove('text-gray-500', 'hover:text-gray-700');
            tabCondiciones.classList.remove('active', 'border-teal-500', 'text-teal-600');
            tabCondiciones.classList.add('text-gray-500', 'hover:text-gray-700');
            
            seccionAntecedentes.classList.remove('hidden');
            seccionAntecedentes.classList.add('seccion-activa');
            seccionCondiciones.classList.add('hidden');
            seccionCondiciones.classList.remove('seccion-activa');
        });

        // Capitalización y limpieza en tiempo real para los inputs
        const nombreInput = document.getElementById('nombre');
        const descripcionCondicionInput = document.getElementById('descripcion');
        const descripcionAntecedenteInput = document.getElementById('descripcion2');

        if (nombreInput) {
            nombreInput.addEventListener('input', function () {
                sanitizeAndCapitalize(this);
            });
        }

        if (descripcionCondicionInput) {
            descripcionCondicionInput.addEventListener('input', function () {
                sanitizeAndCapitalize(this);
            });
        }

        if (descripcionAntecedenteInput) {
            descripcionAntecedenteInput.addEventListener('input', function () {
                sanitizeAndCapitalize(this);
            });
        }

        // Capitalizar todos los campos de descripción en los modales de edición
        document.querySelectorAll("textarea[id^='editar_descripcion']").forEach(textarea => {
            textarea.addEventListener('input', function () {
                sanitizeAndCapitalize(this);
            });
        });

        document.querySelectorAll("input[id^='editar_nombre']").forEach(input => {
            input.addEventListener('input', function () {
                sanitizeAndCapitalize(this);
            });
        });

        // Cargar íconos de Lucide
        lucide.createIcons();

        // SweetAlert2 para confirmar ocultar antecedente o condición
        const forms = document.querySelectorAll('.ocultar-form');
        forms.forEach(form => {
            form.addEventListener('submit', function (e) {
                e.preventDefault(); // Detener envío por defecto

                Swal.fire({
                    title: '¿Estás seguro?',
                    text: "Esta acción ocultará el registro de forma permanente.",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#d33',
                    cancelButtonColor: '#3085d6',
                    confirmButtonText: 'Sí, ocultar',
                    cancelButtonText: 'Cancelar',
                    background: '#ffffff',
                    backdrop: 'rgba(0,0,0,0.4)'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            });
        });
    });

    // Abrir y cerrar modal de antecedentes con animación
    window.openModalEditarAntecedente = function(id) {
        const modal = document.getElementById(`modalEditarAntecedente${id}`);
        const modalContent = document.getElementById(`modalAntecedenteContent${id}`);
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
        
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
    };

    window.cerrarModalEditarAntecedente = function(id) {
        const modal = document.getElementById(`modalEditarAntecedente${id}`);
        const modalContent = document.getElementById(`modalAntecedenteContent${id}`);
        
        if (modal) {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.remove('flex');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }
    };

    // Abrir y cerrar modal de condiciones con animación
    window.openModalEditarCondicion = function(id) {
        const modal = document.getElementById(`modalEditarCondicion${id}`);
        const modalContent = document.getElementById(`modalContent${id}`);
        
        modal.classList.remove('hidden');
        modal.classList.add('flex');
        document.body.style.overflow = 'hidden';
        
        setTimeout(() => {
            modalContent.classList.remove('scale-95', 'opacity-0');
            modalContent.classList.add('scale-100', 'opacity-100');
        }, 10);
    };

    window.cerrarModalEditarCondicion = function(id) {
        const modal = document.getElementById(`modalEditarCondicion${id}`);
        const modalContent = document.getElementById(`modalContent${id}`);
        
        if (modal) {
            modalContent.classList.remove('scale-100', 'opacity-100');
            modalContent.classList.add('scale-95', 'opacity-0');
            
            setTimeout(() => {
                modal.classList.remove('flex');
                modal.classList.add('hidden');
                document.body.style.overflow = '';
            }, 300);
        }
    };
</script>

<style>
    .tab-button.active {
        color: #0d9488;
        border-bottom: 2px solid #0d9488;
    }
    
    .seccion-activa {
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    .truncate {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .truncate:hover {
        white-space: normal;
        overflow: visible;
    }
    
    .transition-all {
        transition-property: all;
        transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        transition-duration: 150ms;
    }
    
    .transform {
        transform: scale(1);
    }
    
    .scale-95 {
        transform: scale(0.95);
    }
    
    .scale-100 {
        transform: scale(1);
    }
    
    .opacity-0 {
        opacity: 0;
    }
    
    .opacity-100 {
        opacity: 1;
    }
</style>
{% endblock %}